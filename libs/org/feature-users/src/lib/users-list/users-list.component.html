<div class="users-list">
  <lib-header
    title="Athena"
    [menuItems]="headerMenuItems"
    [userMenuItems]="userMenuItems"
    [showUserMenu]="true"
    [userName]="authService.getCurrentUser()?.email || 'User'"
  />
  <div class="users-list__container">
    <lib-sidebar
      [menuItems]="sidebarMenuItems"
      [collapsed]="sidebarCollapsed"
      [collapsible]="true"
      (toggleCollapse)="onSidebarToggle($event)"
    />
    <main class="users-list__main" [class.users-list__main--collapsed]="sidebarCollapsed">
      <div class="users-list__content">
        <div class="users-list__header">
          <h1 class="users-list__title">Users Management</h1>
          <button type="button" class="btn btn-primary" (click)="onCreate()">Create User</button>
        </div>

        @if (errorMessage) {
        <div class="error-message">
          {{ errorMessage }}
        </div>
        }

        <lib-card title="Filters" subtitle="Filter users">
          <div class="filters">
            <div class="filter-group">
              <label for="search">Search</label>
              <input
                id="search"
                type="text"
                [(ngModel)]="searchQuery"
                (keyup.enter)="onSearch()"
                placeholder="Search by email, username..."
                class="form-control"
              />
            </div>
            <div class="filter-group">
              <label for="role">Role</label>
              <select
                id="role"
                [(ngModel)]="roleFilter"
                (change)="onFilterChange()"
                class="form-control"
              >
                <option value="">All Roles</option>
                <option value="admin">Admin</option>
                <option value="user">User</option>
              </select>
            </div>
            <div class="filter-group">
              <label for="status">Status</label>
              <select
                id="status"
                [(ngModel)]="isActiveFilter"
                (change)="onFilterChange()"
                class="form-control"
              >
                <option [ngValue]="null">All</option>
                <option [ngValue]="true">Active</option>
                <option [ngValue]="false">Inactive</option>
              </select>
            </div>
            <div class="filter-group">
              <button type="button" class="btn btn-secondary" (click)="onSearch()">Apply Filters</button>
            </div>
          </div>
        </lib-card>

        <lib-card title="Users" subtitle="List of all users">
          <div class="table-wrapper">
            <table class="users-table">
              <thead>
                <tr>
                  <th>Email</th>
                  <th>Username</th>
                  <th>First Name</th>
                  <th>Last Name</th>
                  <th>Roles</th>
                  <th>Status</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody>
                @if (loading) {
                <tr>
                  <td colspan="7" class="loading-cell">Loading users...</td>
                </tr>
                } @else if (users.length === 0) {
                <tr>
                  <td colspan="7" class="empty-cell">No users found</td>
                </tr>
                } @else { @for (user of users; track user.id) {
                <tr>
                  <td>{{ user.email }}</td>
                  <td>{{ user.username }}</td>
                  <td>{{ user.firstName || 'N/A' }}</td>
                  <td>{{ user.lastName || 'N/A' }}</td>
                  <td>
                    @for (role of user.roles; track role) {
                    <span class="badge badge-primary">{{ role }}</span>
                    }
                  </td>
                  <td>
                    <span [class]="'badge ' + (user.isActive ? 'badge-success' : 'badge-danger')">
                      {{ user.isActive ? 'Active' : 'Inactive' }}
                    </span>
                  </td>
                  <td>
                    <div class="actions">
                      <button type="button" class="btn btn-sm btn-secondary" (click)="onView(user)">View</button>
                      <button type="button" class="btn btn-sm btn-primary" (click)="onEdit(user)">Edit</button>
                      <button type="button" class="btn btn-sm btn-danger" (click)="onDelete(user)">Delete</button>
                    </div>
                  </td>
                </tr>
                } }
              </tbody>
            </table>
          </div>

          @if (totalPages > 1) {
          <div class="pagination">
            <button
              type="button"
              class="btn btn-sm"
              [disabled]="currentPage === 1"
              (click)="onPageChange(currentPage - 1)"
            >
              Previous
            </button>
            <span class="pagination-info">
              Page {{ currentPage }} of {{ totalPages }} ({{ totalUsers }} total)
            </span>
            <button
              type="button"
              class="btn btn-sm"
              [disabled]="currentPage === totalPages"
              (click)="onPageChange(currentPage + 1)"
            >
              Next
            </button>
          </div>
          }
        </lib-card>
      </div>
    </main>
  </div>
</div>
